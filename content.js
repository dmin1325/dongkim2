(()=>{"use strict";const t=globalThis.browser||chrome,e={maxHoursPerDay:24};var n;function r(t){return["",n.Jan,n.Feb,n.Mar,n.Apr,n.May,n.Jun,n.Jul,n.Aug,n.Sep,n.Oct,n.Nov,n.Dec][Number(t)]}function o(){const t=document.querySelector(".login");if(t?.dataset.login)return t.dataset.login;const e=document.querySelector('a[href*="mailto"]');let n=null;return e?(n=e.textContent?.split("@"),n&&n.length>0?n[0]:void 0):void 0}function i(t){document.querySelectorAll("table.table-fixed").forEach(e=>{const r=e.querySelector("thead");if(!r)return;const o=r.querySelector("tr");if(!o)return;const i=o.querySelectorAll("th");if(r.querySelector("tr[data-logtime]"))return;const c=document.createElement("tr");c.setAttribute("data-logtime","true"),i.forEach(e=>{let r,o=e.textContent?.trim().toLowerCase();for(const t in n)if(n[t]===o){r=n[t];break}const i=document.createElement("td");if(i.colSpan=e.colSpan||1,i.style.textAlign="center",r&&t[r]){const{hour:e,min:n}=t[r];i.textContent=`${e.toString().padStart(2,"0")}h ${n.toString().padStart(2,"0")}m`,i.style.color="#007B7C",i.style.fontWeight="bold"}else i.textContent="-";c.appendChild(i)}),r.appendChild(c)})}async function c(n){const o=await async function(t){try{const e=await fetch(`https://translate.intra.42.fr/users/${t}/locations_stats.json`,{credentials:"include"});if(!e.ok)throw new Error("네트워크 오류");return await e.json()}catch(t){return console.error("요청 실패:",t),null}}(n);if(!o)return;const c=await async function(n){const o=(await async function(){return new Promise(n=>{t.storage.sync.get(["settings"],t=>{t.settings?n({...e,...t.settings}):n(e)})})}()).maxHoursPerDay,i={};for(const t in n){const[e,c]=t.split("-"),a=r(c),s=n[t].split(".")[0],[l,u,d]=s.split(":").map(Number);let m=l,f=u;l>o?(m=o,f=0):l===o&&(f=0),i[a]||(i[a]={hour:0,min:0}),i[a].hour+=m,i[a].min+=f}for(const[t,e]of Object.entries(i))if(e){const t=e.min;e.hour+=Math.floor(t/60),e.min=t%60}return i}(o);document.querySelectorAll("text[data-42time]").forEach(t=>t.remove()),document.querySelectorAll("tr[data-logtime]").forEach(t=>t.remove());const a=document.getElementById("user-locations");a&&a.querySelectorAll("text").forEach(t=>{const e=t.textContent?.trim().toLowerCase();if(e&&c[e]){const{hour:n,min:r}=c[e],o=t.getAttribute("x"),i=t.getAttribute("y");if(!Array.from(a.querySelectorAll("text")).some(e=>e!==t&&e.getAttribute("x")===o&&e.getAttribute("y")===(parseInt(i)+12).toString()&&e.textContent?.match(/\d+h \d+m/))){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x",o),e.setAttribute("y",(parseInt(i)+12).toString()),e.setAttribute("fill","#007B7C"),e.setAttribute("font-size","10"),e.setAttribute("font-family","sans-serif"),e.setAttribute("data-42time","true"),e.textContent=`${n.toString().padStart(2,"0")}h ${r.toString().padStart(2,"0")}m`,t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)}}}),i(c),function(t){new MutationObserver((e,n)=>{const r=document.querySelectorAll("table.table-fixed");let o=!1;r.forEach(e=>{const n=e.querySelector("thead");if(!n)return;const r=n.querySelector("tr");if(!r)return;const c=r.querySelectorAll("th");!n.querySelector("tr[data-logtime]")&&c.length>0&&(i(t),o=!0)}),o&&n.disconnect()}).observe(document.body,{childList:!0,subtree:!0})}(c)}!function(t){t.Jan="jan",t.Feb="feb",t.Mar="mar",t.Apr="apr",t.May="may",t.Jun="jun",t.Jul="jul",t.Aug="aug",t.Sep="sep",t.Oct="oct",t.Nov="nov",t.Dec="dec"}(n||(n={})),(globalThis.browser||chrome).runtime.onMessage.addListener((t,e,n)=>{if("SETTINGS_UPDATED"===t.type){const t=o();t&&c(t)}}),function t(e,n=10){const r=o();r?e(r):n>0?setTimeout(()=>t(e,n-1),300):console.log("login not found")}(t=>{c(t)})})();